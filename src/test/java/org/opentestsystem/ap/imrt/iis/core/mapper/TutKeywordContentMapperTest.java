package org.opentestsystem.ap.imrt.iis.core.mapper;

import org.junit.Test;
import org.opentestsystem.ap.common.model.TiItem;
import org.opentestsystem.ap.common.model.TutItem;
import org.opentestsystem.ap.imrt.common.model.BaseItem;
import org.opentestsystem.ap.imrt.common.model.KeywordContent;

import java.util.Collection;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.fail;
import static org.mockito.Mockito.mock;
import static org.opentestsystem.ap.imrt.common.model.KeywordContentSection.TutSection.CONTENT;
import static org.opentestsystem.ap.imrt.common.model.KeywordContentSection.TutSection.SPANISH_CONTENT;

public class TutKeywordContentMapperTest {
    private TutKeywordContentMapper mapper = new TutKeywordContentMapper();

    @Test
    public void shouldHandleTutItems() {
        assertThat(mapper.isSupportedItem(new TutItem("123"))).isTrue();
    }

    @Test
    public void shouldConvertItemContent() {
        String englishContent = "  content  <p>English</p> text";
        String spanishContent = "Spanish  content   text ";

        TutItem stim = new TutItem("123");
        stim.getCore().getEn().setContent(englishContent);
        stim.getTranslations().getEsp().setContent(spanishContent);
        BaseItem baseItem = mock(BaseItem.class);

        Collection<KeywordContent> keywordContents = mapper.findKeywordForItem(baseItem, stim);

        assertThat(keywordContents).hasSize(2);

        for (KeywordContent content : keywordContents) {
            assertThat(content.getItem()).isEqualTo(baseItem);
            switch (content.getSection()) {
                case CONTENT:
                    assertThat(content.getContent()).isEqualTo("content English text");
                    break;
                case SPANISH_CONTENT:
                    assertThat(content.getContent()).isEqualTo("Spanish content text");
                    break;
                default:
                    fail("Found invalid section " + content.getSection());
            }
        }
    }

    @Test(expected = IllegalArgumentException.class)
    public void shouldHandleIfWrongTypeIsPassedIn() {
        mapper.findKeywordForItem(mock(BaseItem.class), new TiItem("123"));
    }
}