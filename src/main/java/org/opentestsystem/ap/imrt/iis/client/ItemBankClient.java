package org.opentestsystem.ap.imrt.iis.client;

import org.gitlab4j.api.Pager;
import org.gitlab4j.api.models.Project;
import org.gitlab4j.api.models.ProjectHook;
import org.opentestsystem.ap.imrt.iis.config.ItemBankProperties;
import org.opentestsystem.ap.imrt.iis.model.ItemBankItemRevision;

import java.time.Instant;
import java.util.List;
import java.util.Optional;

/**
 * Interface for Item Bank operations
 */
public interface ItemBankClient {
    /**
     * Register an object to be called for item creation and update events
     *
     * @param listener Listener to be notified for Item creation or updates
     */
    void setItemEventListener(ItemEventListener listener);

    /**
     * Registers an interest in the item. Once this method is called, any changes to the item
     * will result in a call to the onItemUpdate method in the listener.
     *
     * @param itemId Unique identifier for the item.
     */
    void monitorItem(int itemId);

    /**
     * Retrieves the history of an item from the item bank
     *
     * @param itemId Unique identifier for the item
     * @param since  Only entries since this date will be returned
     * @return The list of historical commits
     */
    List<ItemBankItemRevision> getItemHistory(int itemId, Instant since);

    /**
     * Fetch the most recent revision for the item from its repository.
     *
     * @param itemId The identifier of the project in source control
     * @return An {@link org.opentestsystem.ap.imrt.iis.model.ItemBankItemRevision} representing the most recent
     * commit to the item.
     */
    Optional<ItemBankItemRevision> getMostRecentRevision(int itemId);

    /**
     * Get a {@link org.gitlab4j.api.Pager} of {@link org.gitlab4j.api.Pager} contained in the GitLab group.
     *
     * @param pageSize The number of elements the {@link org.gitlab4j.api.Pager} should contain.
     * @return A {@link org.gitlab4j.api.Pager} of {@link org.gitlab4j.api.Pager}
     */
    Pager<Project> getProjects(int pageSize);

    /**
     * Get a collection of {@link org.gitlab4j.api.models.ProjectHook}s for the specified
     * {@link org.gitlab4j.api.models.Project} identifier.
     *
     * @param projectId The id of the {@link org.gitlab4j.api.models.Project}.
     * @return A collection of {@link org.gitlab4j.api.models.ProjectHook}s for the specified
     * {@link org.gitlab4j.api.models.Project}
     */
    List<ProjectHook> getProjectHooks(int projectId);

    /**
     * Expose how the {@link org.opentestsystem.ap.imrt.iis.client.ItemBankClient} is configured.
     *
     * @return an {@link org.opentestsystem.ap.imrt.iis.config.ItemBankProperties} object describing the configuration
     * properties assigned to the {@link org.opentestsystem.ap.imrt.iis.client.ItemBankClient} implementation.
     */
    ItemBankProperties getItemBankProperties();
}
