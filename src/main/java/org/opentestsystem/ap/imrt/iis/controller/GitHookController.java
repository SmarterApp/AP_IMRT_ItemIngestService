package org.opentestsystem.ap.imrt.iis.controller;

import org.opentestsystem.ap.imrt.iis.client.GitlabHookClient;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;

/**
 * Endpoint for system and web hooks received from GitLab
 */
@RestController
public class GitHookController {
    private static final Logger logger = LoggerFactory.getLogger(GitHookController.class);
    private final GitlabHookClient gitlabHookClient;

    @Autowired
    public GitHookController(GitlabHookClient gitlabHookClient) {
        this.gitlabHookClient = gitlabHookClient;
    }

    /**
     * This API will be invoked from Gitlab
     *
     * @param request The incoming HTTP request
     */
    @RequestMapping("/systemHook")
    public void systemHook(HttpServletRequest request) {
        logger.debug("SystemHook with: {}", request);
        // Pass this into the client for parsing and processing.
        gitlabHookClient.handleSystemHook(request);
        logger.debug("SystemHook Done");
    }

    /**
     * This API will be invoked from Gitlab
     *
     * @param request The incoming HTTP request
     */
    @RequestMapping("/webHook")
    public void webHook(HttpServletRequest request) {
        logger.debug("webHook: {}", request);
        // Pass this into the client for parsing and processing.
        gitlabHookClient.handleWebHook(request);
        logger.debug("WebHook Done");
    }

}
