package org.opentestsystem.ap.imrt.iis.service;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.imrt.common.model.ItemGitInformation;
import org.opentestsystem.ap.imrt.iis.core.ItemRevisionComparisonRule;
import org.opentestsystem.ap.imrt.iis.model.ItemRevision;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * Applies all defined {@link ItemRevisionComparisonRule}'s to an item revision
 */
@Component
public class ItemRevisionProcessor {

    private final List<ItemRevisionComparisonRule> itemRevisionComparisonRules;

    @Autowired
    public ItemRevisionProcessor(List<ItemRevisionComparisonRule> itemRevisionComparisonRules) {
        this.itemRevisionComparisonRules = itemRevisionComparisonRules;
    }

    /**
     * Applies all defined comparison rules to an item revision
     *
     * @param existing The {@link ItemGitInformation} as it currently exists
     * @param current  The new {@link ItemRevision} being ingested
     * @return The {@link ItemRevision} after being updated by rules
     */
    public ItemRevision applyRules(ItemGitInformation existing, Item existingItem, ItemRevision current) {
        for (ItemRevisionComparisonRule rule : itemRevisionComparisonRules) {
            current = rule.applyBusinessRule(existing, existingItem, current);
        }
        return current;
    }
}
