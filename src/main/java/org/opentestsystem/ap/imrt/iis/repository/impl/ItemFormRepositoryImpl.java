package org.opentestsystem.ap.imrt.iis.repository.impl;

import org.opentestsystem.ap.imrt.common.model.BaseItem;
import org.opentestsystem.ap.imrt.common.repository.FormRepository;
import org.opentestsystem.ap.imrt.iis.repository.ItemFormRepository;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;

@Repository
public class ItemFormRepositoryImpl implements ItemFormRepository {
    private final FormRepository formRepository;
    private final EntityManager entityManager;

    public ItemFormRepositoryImpl(final FormRepository formRepository,
                                  final EntityManager entityManager) {
        this.formRepository = formRepository;
        this.entityManager = entityManager;
    }

    @Override
    public void deleteAllFormsByItemId(final BaseItem item) {
        formRepository.deleteAllByItem(item);

        //This is required since there is no way to uniquely identify Forms
        entityManager.flush();
    }
}
