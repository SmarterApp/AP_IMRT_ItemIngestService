package org.opentestsystem.ap.imrt.iis.business;

import org.opentestsystem.ap.imrt.common.model.ItemGitInformation;
import org.opentestsystem.ap.imrt.iis.model.ItemRevision;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;

/**
 * Business rule to capture the time when the item workflow status was modified
 */
@Component
public class ItemRevisionTimeInWorkflowRule implements ItemRevisionComparisonRule {
    private static final Logger logger = LoggerFactory.getLogger(ItemRevisionTimeInWorkflowRule.class);

    @Override
    public ItemRevision applyBusinessRule(ItemGitInformation existing, ItemRevision current) {
        logger.debug("Existing workflow {} current workflow {}",
                existing != null ? existing.getItem().getWorkflowStatus() : null,
                current.getImrtItem().getWorkflowStatus());
        if (null == existing || !current.getImrtItem().getWorkflowStatus().equals(existing.getItem().getWorkflowStatus())) {
            logger.debug("Workflow status has changed");
            // TODO Set time of current workflow status field in current ImrtItem. Add a test
        }
        return current;
    }
}
